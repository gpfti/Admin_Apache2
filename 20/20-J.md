
# Conexión Apache2 <> Apache Tomcat

Conectar **Apache HTTP Server** (httpd) con **Apache Tomcat** permite usar Apache como servidor frontal que maneja las peticiones HTTP estáticas (como imágenes, CSS, JS) y redirige las dinámicas (como servlets y JSPs) a Tomcat. Esto se hace principalmente por eficiencia y flexibilidad.

### Formas comunes de conectar Apache con Tomcat:

#### 1. **Usar el módulo `mod_proxy` (recomendado, es el método moderno de conexión)**

Es el método más actual y mantenido. Utiliza `mod_proxy` y `mod_proxy_ajp` o `mod_proxy_http`.

##### a) **Habilita los módulos necesarios**:

En Debian/Ubuntu:

```bash
sudo a2enmod proxy
sudo a2enmod proxy_ajp   # o proxy_http
sudo systemctl restart apache2
```

##### b) **Configura el VirtualHost en Apache**:

```apache
<VirtualHost *:80>
    ServerName midominio.com

    ProxyPass /app ajp://localhost:8009/app
    ProxyPassReverse /app ajp://localhost:8009/app
</VirtualHost>
```

O con HTTP en lugar de AJP (si AJP está deshabilitado):

```apache
<VirtualHost *:80>
    ServerName midominio.com

    ProxyPass /app http://localhost:8080/app
    ProxyPassReverse /app http://localhost:8080/app
</VirtualHost>
```
##### RECORDATORIO: Comprobar configuración activa en Apache2

Para ver los sitios habilitados en Apache2 en sistemas como Ubuntu/Debian puedes usar:

```bash
ls /etc/apache2/sites-enabled/
```

Este directorio contiene enlaces simbólicos a los archivos reales de configuración que están en:

```bash
/etc/apache2/sites-available/
```

---

### **Ver qué sitios están habilitados y su contenido**

1. **Listar los sitios habilitados:**

```bash
ls -l /etc/apache2/sites-enabled/
```

2. **Ver el contenido de un sitio habilitado:**

```bash
cat /etc/apache2/sites-enabled/000-default.conf
```

o abre el archivo con un editor:

```bash
sudo nano /etc/apache2/sites-enabled/000-default.conf
```

---

### **Comando extra: comprobar configuración activa**

Para ver un resumen de la configuración actual y sitios cargados:

```bash
apache2ctl -S
```

Este comando muestra:

* Qué archivos de configuración están cargados
* Qué VirtualHosts están definidos
* Qué puertos están escuchando
* Y si hay errores de configuración




#### 2. **Usar `mod_jk` (antiguo y menos recomendable ahora)**

Este módulo conecta Apache y Tomcat usando el protocolo AJP, pero está en desuso frente a `mod_proxy`.

##### a) Instalar `mod_jk`:

En Debian/Ubuntu:

```bash
sudo apt-get install libapache2-mod-jk
```

##### b) Configurar `workers.properties`:

Archivo típico en `/etc/libapache2-mod-jk/workers.properties`:

```properties
worker.list=tomcat
worker.tomcat.type=ajp13
worker.tomcat.host=localhost
worker.tomcat.port=8009
```

##### c) Configurar el VirtualHost:

```apache
<VirtualHost *:80>
    ServerName midominio.com
    JkMount /app/* tomcat
</VirtualHost>
```

---

### Recomendaciones:

* **mod\_proxy** es más simple, moderno y mantenido.
* Asegúrate de que Tomcat esté escuchando en el puerto adecuado (por defecto 8080 para HTTP, 8009 para AJP).
* Puedes añadir reglas adicionales para redirigir solo ciertas rutas a Tomcat.



