# Archivos `.htaccess` en Apache HTTP

## ¿Qué es un archivo `.htaccess`?

El archivo `.htaccess` (hypertext access) es un archivo de configuración que permite modificar el comportamiento del servidor Apache sin necesidad de editar el archivo principal de configuración (`httpd.conf`). Se utiliza comúnmente para:

* Reescrituras de URL
* Redirecciones
* Control de acceso
* Configuración de caché
* Autenticación básica

## Requisitos previos

Antes de utilizar `.htaccess`, asegúrate de que Apache tenga activado el uso de este tipo de archivos. Esto se configura mediante la directiva `AllowOverride` en el archivo principal de configuración o en los bloques `<Directory>`.

Ejemplo en `apache2.conf` o `httpd.conf`:

```apache
<Directory /var/www/html>
    AllowOverride All
</Directory>
```

Si `AllowOverride` está en `None`, Apache ignorará los archivos `.htaccess`.

## Ubicación del archivo `.htaccess`

Puedes colocar el archivo `.htaccess` en el directorio raíz del sitio web o en cualquier subdirectorio donde desees aplicar configuraciones específicas.

Por ejemplo:

```
/var/www/html/.htaccess
```

## Sintaxis básica

Las directivas que se usan en `.htaccess` son las mismas que en la configuración principal de Apache, pero limitadas a las permitidas por `AllowOverride`.

### 1. Redirecciones

#### Redirección 301 (permanente)

```apache
Redirect 301 /vieja-url.html https://tusitio.com/nueva-url.html
```

#### Redirección con mod\_rewrite

```apache
RewriteEngine On
RewriteRule ^articulo-antiguo$ /articulo-nuevo [R=301,L]
```

### 2. Reescritura de URLs amigables

```apache
RewriteEngine On
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.+)$ index.php?url=$1 [QSA,L]
```

### 3. Protección de directorios

#### Autenticación básica

1. Crea un archivo `.htpasswd` con usuarios:

```bash
htpasswd -c /ruta/segura/.htpasswd usuario
```

2. Añade esto al `.htaccess`:

```apache
AuthType Basic
AuthName "Zona restringida"
AuthUserFile /ruta/segura/.htpasswd
Require valid-user
```

### 4. Negar o permitir acceso por IP

#### Denegar todo excepto una IP

```apache
Order Deny,Allow
Deny from all
Allow from 192.168.1.100
```

#### Negar una IP específica

```apache
Order Allow,Deny
Allow from all
Deny from 123.45.67.89
```

### 5. Impedir acceso a archivos específicos

```apache
<Files config.php>
    Order allow,deny
    Deny from all
</Files>
```

### 6. Evitar listado de directorios

```apache
Options -Indexes
```

### 7. Establecer página de error personalizada

```apache
ErrorDocument 404 /errores/404.html
ErrorDocument 403 /errores/403.html
```

## Consideraciones de rendimiento

* Apache analiza los archivos `.htaccess` en cada petición, lo que puede impactar el rendimiento.
* Para sitios de alto tráfico, se recomienda usar la configuración directa en los archivos principales (`apache2.conf`, `httpd.conf`, etc.) en lugar de `.htaccess`.

## Conclusión

El archivo `.htaccess` es una herramienta poderosa para personalizar el comportamiento del servidor Apache a nivel de directorio. Su uso adecuado permite implementar funciones avanzadas sin modificar la configuración global del servidor, aunque debe utilizarse con cuidado para evitar problemas de seguridad y rendimiento.


[Vamos al siguiente contenido](./20-F.md)
